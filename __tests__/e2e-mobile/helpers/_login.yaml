# Helper: Login with test user (returning user with profile)
# NOT a standalone test - called via runFlow from other tests
#
# Prerequisites:
# - testuser1@10k.test exists in 10k-dev Supabase Auth
# - testuser1 has a profile in profiles table
#
# Usage: runFlow: "../helpers/_login.yaml"

appId: com.tenk.scorekeeper.dev
---
# Wait for login screen (dev build may take time to load JS bundle)
- extendedWaitUntil:
    visible: "LOG IN"
    timeout: 30000

# Enter email (use accessibilityLabel from LoginScreen.tsx)
- tapOn: "Email address"
- inputText: "testuser1@10k.test"

# Enter password (use accessibilityLabel from LoginScreen.tsx)
- tapOn: "Password"
- inputText: "TestPassword123!"

# Tap login button
- tapOn: "LOG IN"

# Wait for either Home screen or Welcome modal (new user needs profile setup)
- extendedWaitUntil:
    visible: "Home|Welcome"
    timeout: 20000

# Handle Welcome modal if it appears (new user without profile)
- tapOn:
    text: "Continue"
    optional: true
    retryTapIfNoChange: false

# Wait for Home to be visible after Welcome modal dismissed
- extendedWaitUntil:
    visible: "Home"
    timeout: 10000

# Dismiss any error dialogs that may appear
- tapOn:
    text: "OK"
    optional: true
    retryTapIfNoChange: false
